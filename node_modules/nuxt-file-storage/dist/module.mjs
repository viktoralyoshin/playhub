import { defineNuxtModule, createResolver, addImportsDir, addServerScanDir } from '@nuxt/kit';
import defu from 'defu';

const module = defineNuxtModule({
  meta: {
    name: "nuxt-file-storage",
    configKey: "fileStorage"
  },
  //? Default configuration options of the Nuxt module
  //! no defaults for now
  // defaults: {
  // 	mount: 'userFiles',
  // },
  setup(options, nuxt) {
    const config = nuxt.options.runtimeConfig;
    config.public.fileStorage = defu(config.public.fileStorage, {
      ...options
    });
    const resolve = createResolver(import.meta.url).resolve;
    addImportsDir(resolve("runtime/composables"));
    addServerScanDir(resolve("./runtime/server"));
  }
});

export { module as default };
